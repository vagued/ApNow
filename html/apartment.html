<!DOCTYPE html>
<html>
    <head>
    	<meta charset="UTF-8">
    	<title>Apartment</title>
    	<link rel="stylesheet" href="../css/style.css">

    </head>
    <body id = "def">

		<header>
    	   <div class = "navbar">
		            <a href = "homepage.html" id = "logo"> <img src = "../img/logo.png"> </a>
                	<a href = " " id = "logout">Log out</a>
                	<a href = " " id = "help">Help!</a>
                	<a href = "uploadform.html" id = "upload">Upload</a>
					<div id="navbar2"></div>
         </div>
    	</header>

		   <div class="apartment">
         <img id="photo" src="https://image.flaticon.com/icons/svg/149/149064.svg" />
         <h1 id="title">Title</h1>
         <h2 id="description">Description </h2>
         <h2 id="location">Location</h2>
         <p>Average rating:</p><h2 id="rating">-</h2>

			   <label for = "check in">Check in: </label>
			   <input type = "date" id = "checkin" id = "check in"><br>

			  <label for = "check out">Check out: </label>
			  <input type = "date" id = "checkout" id = "check out"><br>

        <input type = "submit" value = "Book" onClick="book();"><br>

        <label id="error"></label>

        <p id="comments"></p>

		   </div>

       <script>

         var idapartment = location.search.substring(1);

         var xmlhttp, apartment;

    			xmlhttp = new XMLHttpRequest();

    			xmlhttp.onreadystatechange = function()
          {
     			  if (this.readyState == 4 && this.status == 200)
               apartment = JSON.parse(this.responseText);

             document.getElementById("photo").setAttribute("src",
             '../img/apartments/' + idapartment + '.' + apartment[0].extension);

             document.getElementById("title").innerHTML = apartment[0].title;

             document.getElementById("description").innerHTML = apartment[0].description;

             document.getElementById("location").innerHTML = apartment[0].location;
          };

          xmlhttp.open("GET", "../php/return-apartment.php?q=" + idapartment, true);
   			  xmlhttp.send();

          </script>

          <script>

          xmlhttp = new XMLHttpRequest();
    			xmlhttp.onreadystatechange = function()
          {
     			  if (this.readyState == 4 && this.status == 200)
             document.getElementById("rating").innerHTML = this.responseText;
          };

         xmlhttp.open("GET", "../php/return-avg-rating.php?q=" + idapartment, true);
  			 xmlhttp.send();

         </script>

         <script>

         xmlhttp = new XMLHttpRequest();

         var comments_html = "";

         xmlhttp.onreadystatechange = function()
          {
            if (this.readyState == 4 && this.status == 200)
              comments = JSON.parse(this.responseText);

              for (x in apartments)
              {
                comments_html +=
                  '<div class="gallery">' +
                     '<div class="container">' +
                      '<a href="apartment.html?' + apartments[x].idapartment + '"> ' +
                       '<img src="../img/apartments/' +
                       + apartments[x].idapartment + '.' + apartments[x].extension + '" ' +
                       'class="grid-image">' +
                         '<div class="middle">' +
                           '<div class="image-text">' + apartments[x].title + '</div>' +
                         '</div>' +
                       '</a>' +
                     '</div>' +
                   '</div>';
   					 }

   					 document.getElementById("comments").innerHTML = coments_html;
   				 }

          };

        xmlhttp.open("GET", "../php/return-comments.php?q=" + idapartment, true);
        xmlhttp.send();

        </script>

        <script>

         function book()
         {
           var xmlhttp = new XMLHttpRequest();

           xmlhttp.onreadystatechange = function()
           {
             if (this.readyState == 4 && this.status == 200)
             {
               // alert(this.responseText);
               if(this.responseText == 0) {
                document.getElementById("error").innerHTML =
                  "Dates selected not available, please choose others";
                }
                else
                {
                  window.location.href = "profile.html";
                }
              }
           };

          xmlhttp.open("GET","../php/submit-renting.php?ida=" + idapartment +
            "&idc=" + sessionStorage.idClient +
            "&cin=" + document.getElementById("checkin").value +
            "&cout=" + document.getElementById("checkout").value,
            true);

          xmlhttp.send();
         }
       </script>

	   <div class="footer">
           <div class="container">
               <p>&copy; ApNow 2018</p>
           </div>
      </div>
	</body>
</html>
